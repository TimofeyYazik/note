**DHCP** ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA "Английский язык") Dynamic Host Configuration Protocol — протокол динамической настройки [узла](https://ru.wikipedia.org/wiki/%D0%A5%D0%BE%D1%81%D1%82 "Хост")) — [сетевой протокол](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB "Сетевой протокол"), позволяющий [сетевым устройствам](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B5_%D1%83%D1%81%D1%82%D1%80%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%BE "Сетевое устройство") автоматически получать [IP-адрес](https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "IP-адрес") и другие параметры, необходимые для работы в сети [TCP/IP](https://ru.wikipedia.org/wiki/TCP/IP "TCP/IP"). Данный протокол работает по модели «[клиент-сервер](https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80 "Клиент-сервер")». Для автоматической конфигурации компьютер-клиент на этапе конфигурации сетевого устройства обращается к так называемому _серверу DHCP_ и получает от него нужные параметры. [Сетевой администратор](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D0%B0%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%BE%D1%80 "Сетевой администратор") может задать диапазон адресов, распределяемых сервером среди компьютеров. Это позволяет избежать ручной настройки компьютеров сети и уменьшает количество ошибок. Протокол DHCP используется в большинстве сетей TCP/IP.
## Распределение IP-адресов

Протокол DHCP предоставляет три способа распределения [IP-адресов](https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "IP-адрес"):

- _Ручное распределение._ При этом способе сетевой администратор сопоставляет аппаратному адресу (для Ethernet-сетей это [MAC-адрес](https://ru.wikipedia.org/wiki/MAC-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "MAC-адрес")) каждого [клиентского](https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82_(%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0) "Клиент (информатика)") компьютера определённый IP-адрес. Фактически данный способ распределения адресов отличается от ручной настройки каждого компьютера лишь тем, что сведения об адресах хранятся централизованно (на [сервере](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B5_%D0%BE%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D0%B5) "Сервер (программное обеспечение)") DHCP), и потому их проще изменять при необходимости.
- _Автоматическое распределение._ При данном способе каждому компьютеру на постоянное использование выделяется произвольный свободный IP-адрес из определённого администратором диапазона.
- _Динамическое распределение._ Этот способ аналогичен автоматическому распределению за исключением того, что адрес выдаётся компьютеру не на постоянное пользование, а на определённый срок. Это называется _арендой адреса_. По истечении срока аренды IP-адрес вновь считается свободным, и клиент обязан запросить новый (он, впрочем, может оказаться тем же самым). Кроме того, клиент сам может отказаться от полученного адреса.
Некоторыми из наиболее часто используемых опций являются:

- IP-адрес [маршрутизатора](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80 "Маршрутизатор") по умолчанию;
- [маска подсети](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%81%D0%BA%D0%B0_%D0%BF%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B8 "Маска подсети");
- адреса [серверов](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80_(%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5) "Сервер (приложение)") [DNS](https://ru.wikipedia.org/wiki/DNS "DNS");
- имя домена [[DNS]].

Некоторые поставщики программного обеспечения могут определять собственные, дополнительные опции DHCP.

Протокол DHCP является _клиент-серверным_, то есть в его работе участвуют [клиент](https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D1%8B%D0%B9) "Клиент (программный)") DHCP и [сервер](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%80%D0%B2%D0%B5%D1%80_(%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5) "Сервер (приложение)") DHCP. Передача данных производится при помощи протокола [[UDP]]. По умолчанию запросы от клиента делаются к серверу на порт 67, сервер в свою очередь отвечает клиенту на порт 68, выдавая адрес IP и другую необходимую информацию, такую, как сетевую маску, маршрутизатор и серверы DNS.

### Пример процесса получения адреса

Рассмотрим пример процесса получения IP-адреса клиентом от сервера DHCP. Предположим, клиент ещё не имеет собственного IP-адреса, но ему известен свой предыдущий адрес — 192.168.1.100. Процесс состоит из четырёх этапов. Эти этапы часто сокращаются как DORA (Discovery, Offer, Request, и Acknowledgement)

#### Обнаружение DHCP

Вначале клиент выполняет широковещательный запрос по всей физической сети с целью обнаружить доступные DHCP-серверы. Он отправляет сообщение типа **DHCPDISCOVER**(значение опции «Тип сообщения» — 1), при этом в качестве IP-адреса источника указывается 0.0.0.0 (если компьютер ещё не имеет собственного IP-адреса), а в качестве адреса назначения —[широковещательный адрес](https://ru.wikipedia.org/wiki/%D0%A8%D0%B8%D1%80%D0%BE%D0%BA%D0%BE%D0%B2%D0%B5%D1%89%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "Широковещательный адрес") 255.255.255.255.

Клиент заполняет несколько полей сообщения начальными значениями:

- В поле **xid** помещается уникальный _идентификатор транзакции_, который позволяет отличать данный процесс получения IP-адреса от других, протекающих в то же время.
- В поле **chaddr** помещается аппаратный адрес ([MAC-адрес](https://ru.wikipedia.org/wiki/MAC-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "MAC-адрес")) клиента.
- В поле опций указывается последний известный клиенту IP-адрес. В данном примере это 192.168.1.100. Это необязательно и может быть проигнорировано сервером.

Сообщение DHCPDISCOVER может быть распространено за пределы локальной физической сети при помощи специально настроенных _агентов ретрансляции DHCP_, перенаправляющих поступающие от клиентов сообщения DHCP серверам в других подсетях.

Не всегда процесс получения IP-адреса начинается с **DHCPDISCOVER**. В случае, если клиент ранее уже получал IP-адрес и срок его аренды ещё не прошёл — клиент может пропустить стадию DHCPDISCOVER, начав с запроса **DHCPREQUEST**, отправляемого с идентификатором сервера, который выдал адрес в прошлый раз. В случае же отсутствия ответа от DHCP-сервера, выдавшего настройки в прошлый раз, клиент отправляет **DHCPDISCOVER**. Тем самым клиент начинает процесс получения с начала, обращаясь уже ко всем DHCP-серверам в сегменте сети.

#### Предложение DHCP

Получив сообщение от клиента, сервер определяет требуемую конфигурацию клиента в соответствии с указанными сетевым администратором настройками. В данном случае DHCP-сервер согласен с запрошенным клиентом адресом 192.168.1.100. Сервер отправляет ему ответ **DHCPOFFER** (значение опции «Тип сообщения» — 2), в котором предлагает конфигурацию. Предлагаемый клиенту IP-адрес указывается в поле **yiaddr**. Прочие параметры (такие, как адреса маршрутизаторов и [DNS](https://ru.wikipedia.org/wiki/DNS "DNS")-серверов) указываются в виде опций в соответствующем поле.

Это сообщение DHCP-сервер отправляет хосту, пославшему DHCPDISCOVER, на его MAC, при определенных обстоятельствах сообщение может распространяться как широковещательная рассылка. Клиент может получить несколько различных предложений DHCP от разных серверов; из них он должен выбрать то, которое его «устраивает».

#### Запрос DHCP

Выбрав одну из конфигураций, предложенных DHCP-серверами, клиент отправляет запрос **DHCPREQUEST** (значение опции «Тип сообщения» — 3). Он рассылается широковещательно; при этом к опциям, указанным клиентом в сообщении DHCPDISCOVER, добавляется специальная опция — идентификатор сервера — указывающая адрес DHCP-сервера, выбранного клиентом (в данном случае — 192.168.1.1).

Этот же запрос используется, когда время аренды адреса подходит к концу, для продления времени (renewing) или процедуры перепривязки (rebinding). В этих случаях опции «идентификатор сервера» и «запрошенный IP-адрес» не указываются, а поле ciaddr заполняется ранее назначенным адресом клиента. В случае продления времени запрос отправляется не широковещательно, а адресно на выдавший сервер. Только если сервер не отвечает в течение отведённого времени, инициируется процедура перепривязки с широковещательными запросами.

Также запрос используется для инициализации после перезагрузки клиента (init-reboot), когда ему уже известен ранее назначенный адрес. В таком случае DHCPDISCOVER не выполняется, а сразу отсылается широковещательный DHCPREQUEST без указания опции «идентификатор сервера», но с известным адресом в опции «запрошенный IP-адрес». Поле ciaddr остаётся пустым.

#### Подтверждение DHCP

Наконец, сервер подтверждает запрос и направляет подтверждение **DHCPACK** (значение опции «Тип сообщения» — 5) клиенту. После этого клиент должен настроить свой сетевой интерфейс, используя предоставленные опции.

#### Вид сообщений

Ниже приведены примеры значений каждого поля для каждого из отправляемых в процессе сообщений DHCP. В примере устройство с [MAC-адресом](https://ru.wikipedia.org/wiki/MAC-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "MAC-адрес") 00:1D:60:57:ED:80 запрашивает у DHCP сервера [IP-адрес](https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81 "IP-адрес"). Клиент высылает свой последний известный IP-адрес 192.168.1.100 в качестве предлагаемого