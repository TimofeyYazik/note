Заголовок IP (Internet Protocol) уровня является важной частью IP-пакета, который используется для передачи данных по сети. Заголовок IP содержит информацию, необходимую для маршрутизации и доставки пакета от источника к назначению. Рассмотрим заголовок для наиболее часто используемой версии IP - IPv4.

### Структура заголовка IPv4

Заголовок IPv4 состоит из нескольких полей, каждое из которых имеет определённое значение и функцию. Поля заголовка расположены в следующем порядке:

1. **Версия (Version)** (4 бита):
   - Указывает версию протокола IP. Для IPv4 это значение равно 4.

2. **Длина заголовка (IHL - Internet Header Length)** (4 бита):
   - Указывает длину заголовка в 32-битных словах. Минимальное значение - 5 (20 байт), что является минимальным размером заголовка.

3. **Тип обслуживания (Type of Service, TOS)** (8 бит):
   - Позволяет указать предпочтения по качеству обслуживания, такие как задержка, пропускная способность и надёжность.

4. **Общая длина (Total Length)** (16 бит): 
   - Указывает общую длину пакета IP, включая заголовок и данные. Максимальное значение - 65,535 байт.

5. **Идентификатор (Identification)** (16 бит):
   - Уникальный идентификатор пакета, используется для фрагментации и сборки пакетов.

6. **Флаги (Flags)** (3 бита):
   - Контролируют фрагментацию пакетов. Три флага: резервный (должен быть 0), DF (Don't Fragment) и MF (More Fragments).

7. **Смещение фрагмента (Fragment Offset)** (13 бит):
   - Указывает смещение данного фрагмента относительно начала оригинального пакета. Используется для сборки фрагментированных пакетов.

8. **Время жизни (Time to Live, TTL)** (8 бит):
   - Указывает максимальное количество переходов (hop), через которые пакет может пройти. Каждый маршрутизатор уменьшает это значение на 1, и если TTL достигает 0, пакет уничтожается.

9. **Протокол (Protocol)** (8 бит):
   - Указывает протокол верхнего уровня, которому передаётся пакет после обработки на IP-уровне (например, TCP - 6, UDP - 17).

10. **Контрольная сумма заголовка (Header Checksum)** (16 бит):
    - Контрольная сумма для проверки целостности заголовка. Пересчитывается и проверяется на каждом маршрутизаторе.

11. **IP-адрес источника (Source IP Address)** (32 бита):
    - Указывает IP-адрес отправителя пакета.

12. **IP-адрес назначения (Destination IP Address)** (32 бита):
    - Указывает IP-адрес получателя пакета.

13. **Опции (Options)** (необязательное, переменной длины):
    - Дополнительные параметры для управления передачей пакетов. Если используются, длина заголовка должна быть кратна 32 битам.

14. **Заполнитель (Padding)**:
    - Добавляется, если требуется, чтобы длина заголовка была кратна 32 битам.

### Пример заголовка IPv4

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |       Header Checksum         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### Основные функции заголовка IPv4

- **Маршрутизация**: Определяет путь от источника к назначению.
- **Фрагментация и сборка**: Позволяет разбивать большие пакеты на более мелкие и собирать их на стороне получателя.
- **Контроль целостности**: Проверяет целостность заголовка с помощью контрольной суммы.
- **Качество обслуживания**: Позволяет приоритезировать определённые пакеты.

### Примечания

- **IPv6**: В IPv6 заголовок отличается и имеет упрощённую структуру, а также добавлены новые функции для улучшения производительности и безопасности.

Заголовок IPv4 играет ключевую роль в передаче данных по сети, обеспечивая маршрутизацию, целостность и управление пакетами.