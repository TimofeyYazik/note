**ICMP** ([англ.](https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA "Английский язык") Internet Control Message Protocol — протокол межсетевых управляющих сообщений[[1]](https://ru.wikipedia.org/wiki/ICMP#cite_note-1)) — [сетевой протокол](https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB "Сетевой протокол"), входящий в [стек протоколов TCP/IP](https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B5%D0%BA_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%B2_TCP/IP "Стек протоколов TCP/IP"). В основном ICMP используется для передачи сообщений об ошибках и других исключительных ситуациях, возникших при передаче данных, например, запрашиваемая услуга недоступна или хост или [маршрутизатор](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80 "Маршрутизатор") не отвечают. Также на ICMP возлагаются некоторые сервисные функции (services).
#### Технические подробности
Протокол ICMP описан в [RFC 792](https://tools.ietf.org/html/rfc792) от 1981 года Jon Postel (с дополнениями в [RFC 950](https://tools.ietf.org/html/rfc950)). ICMP является [стандартом Интернета](https://ru.wikipedia.org/wiki/RFC#%D0%A1%D0%BE%D0%B4%D0%B5%D1%80%D0%B6%D0%B8%D0%BC%D0%BE%D0%B5_RFC "RFC") (входит в стандарт STD 5 вместе с [IP](https://ru.wikipedia.org/wiki/IP "IP")). Хотя формально протокол использует [IP](https://ru.wikipedia.org/wiki/IP "IP") (ICMP-пакеты [инкапсулируются](https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D0%BA%D0%B0%D0%BF%D1%81%D1%83%D0%BB%D1%8F%D1%86%D0%B8%D1%8F_(%D0%B2_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D1%85_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%B0%D1%85) "Инкапсуляция (в сетевых протоколах)") в IP пакеты), он является неотъемлемой частью IP и обязателен при реализации [стека TCP/IP](https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B5%D0%BA_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%B2_TCP/IP "Стек протоколов TCP/IP"). Текущая версия ICMP для [IPv4](https://ru.wikipedia.org/wiki/IPv4 "IPv4") называется ICMPv4. В [IPv6](https://ru.wikipedia.org/wiki/IPv6 "IPv6") существует аналогичный протокол [ICMPv6](https://ru.wikipedia.org/wiki/ICMPv6 "ICMPv6").

ICMP-сообщение строится из IP-пакетов, сгенерировавших ICMP-ответ. Протокол IP инкапсулирует соответствующее ICMP-сообщение с новым заголовком IP (чтобы отправить ICMP-сообщение обратно отправителю) и передает полученные пакеты дальше.

Например, каждая машина, которая перенаправляет IP-пакеты (например [маршрутизатор](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80 "Маршрутизатор")), уменьшает значение поля [Time to live](https://ru.wikipedia.org/wiki/Time_to_live "Time to live") (TTL) заголовка IP-пакета на единицу; если [TTL](https://ru.wikipedia.org/wiki/Time_to_live "Time to live")достигает 0, на источник пакета отправляется ICMP-сообщение о превышении TTL.

ICMP основан на протоколе IP. Каждое ICMP-сообщение инкапсулируется непосредственно в пределах одного [IP](https://ru.wikipedia.org/wiki/IP "IP")-пакета, и, таким образом, как и [UDP](https://ru.wikipedia.org/wiki/UDP "UDP") и в отличие от [TCP](https://ru.wikipedia.org/wiki/TCP "TCP"), ICMP является т. н. «ненадежным» (не контролирующим доставку и её правильность). В отличие от UDP, где реализация надёжности возложена на ПО прикладного уровня, ICMP (в силу специфики применения) обычно не нуждается в реализации надёжной доставки. Его цели отличны от целей транспортных протоколов, таких как TCP и UDP: он, как правило, не используется для передачи и приёма данных между конечными системами. ICMP не используется непосредственно в приложениях пользователей сети (исключение составляют инструменты [Ping](https://ru.wikipedia.org/wiki/Ping "Ping") и [Traceroute](https://ru.wikipedia.org/wiki/Traceroute "Traceroute")). Тот же Ping, например, служит обычно как раз для проверки потерь IP-пакетов на маршруте.

#### Использование ICMP-сообщений

ICMP-сообщения (тип 1,2) генерируются при нахождении ошибок в заголовке [IP](https://ru.wikipedia.org/wiki/IP "IP")-пакета (за исключением самих ICMP-пакетов, дабы не привести к бесконечно растущему потоку ICMP-сообщений об ICMP-сообщениях).

ICMP-сообщения (тип 3) генерируются [маршрутизатором](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80 "Маршрутизатор") при отсутствии маршрута к адресату.

Утилита [Ping](https://ru.wikipedia.org/wiki/Ping "Ping"), служащая для проверки возможности доставки IP-пакетов, использует ICMP-сообщения с типом 8 (эхо-запрос) и 0 (эхо-ответ).

Утилита [Traceroute](https://ru.wikipedia.org/wiki/Traceroute "Traceroute"), отображающая путь следования IP-пакетов, использует ICMP-сообщения с типом 11.

ICMP-сообщения с типом 5 используются маршрутизаторами для обновления записей в [таблице маршрутизации](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%82%D0%BE%D1%80#%D0%A2%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0_%D0%BC%D0%B0%D1%80%D1%88%D1%80%D1%83%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8 "Маршрутизатор") отправителя.

ICMP-сообщения с типом 4 используются получателем (или маршрутизатором) для управления скоростью отправки сообщений отправителем.