### Структура пакета ARP
**Hardware type (HTYPE)**
Каждый канальный протокол передачи данных имеет свой номер, который хранится в этом поле. Например, [Ethernet](https://ru.wikipedia.org/wiki/Ethernet "Ethernet") имеет номер 0x0001.
**Protocol type (PTYPE)**
Код сетевого протокола. Например, для [IPv4](https://ru.wikipedia.org/wiki/IPv4 "IPv4") будет записано 0x0800.
**Hardware length (HLEN)**
Длина физического адреса в байтах. Адреса Ethernet имеют длину 6 байт (0x06).
**Protocol length (PLEN)**
Длина логического адреса в байтах. IPv4 адреса имеют длину 4 байта (0x04).
**Operation**
Код операции отправителя: 0x0001 в случае запроса и 0x0002 в случае ответа.
**Sender hardware address (SHA)**
Физический адрес отправителя.
**Sender protocol address (SPA)**
Логический адрес отправителя.
**Target hardware address (THA)**
Физический адрес получателя. Не требуется при запросе.
**Target protocol address (TPA)**
Логический адрес получателя.

Рассмотрим суть функционирования _ARP_ на простом примере. Компьютер А (IP-адрес 10.0.0.1) и компьютер Б (IP-адрес 10.22.22.2) соединены сетью [Ethernet](https://ru.wikipedia.org/wiki/Ethernet "Ethernet"). Компьютер А желает переслать пакет данных на компьютер Б, IP-адрес компьютера Б ему известен. Однако сеть Ethernet, которой они соединены, не работает с IP-адресами. Поэтому компьютеру А для осуществления передачи через Ethernet требуется узнать адрес компьютера Б в сети Ethernet (_MAC-адрес_ в терминах Ethernet). Для этой задачи и используется протокол ARP. По этому протоколу компьютер А отправляет широковещательный запрос, адресованный всем компьютерам в одном с ним [широковещательном домене](https://ru.wikipedia.org/wiki/%D0%A8%D0%B8%D1%80%D0%BE%D0%BA%D0%BE%D0%B2%D0%B5%D1%89%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9_%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD "Широковещательный домен"). Суть запроса: «компьютер с IP-адресом 10.22.22.2, сообщите свой _MAC-адрес_ компьютеру с МАС-адресом (напр. a0:ea:d1:11:f1:01)». Сеть Ethernet доставляет этот запрос всем устройствам в том же сегменте Ethernet, в том числе и компьютеру Б. Компьютер Б отвечает компьютеру А на запрос и сообщает свой _MAC-адрес_ (напр. 00:ea:d1:11:f1:11) Теперь, получив _MAC-адрес_ компьютера Б, компьютер А может передавать ему любые данные через сеть Ethernet.

Существуют следующие типы сообщений ARP: запрос ARP (_ARP request_) и ответ ARP (_ARP reply_). Система-отправитель при помощи запроса ARP запрашивает аппаратный адрес системы-получателя, который приходит внутри ответа ARP.

Перед тем, как передать пакет сетевого уровня через сегмент Ethernet, [сетевой стек](https://ru.wikipedia.org/w/index.php?title=%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D1%81%D1%82%D0%B5%D0%BA&action=edit&redlink=1 "Сетевой стек (страница отсутствует)") проверяет кэш ARP, чтобы выяснить, не зарегистрирована ли уже в его таблице нужная информация об узле-получателе. Если такой записи в кэше ARP нет, то выполняется широковещательный запрос ARP. Этот запрос для устройств в сети имеет следующий смысл: «Кто-нибудь знает физический адрес устройства, обладающего таким-то адресом IP?» Когда хост с этим адресом IP примет такой пакет запроса, он должен ответить: «Да, это мой адрес IP и мой аппаратный адрес такой-то». После этого отправитель запроса сохранит аппаратный адрес получателя в свой кэш ARP и сможет адресно передать информацию получателю.

Ниже приведён пример запроса и ответа ARP. <см. внизу страницы>

Записи в кэше ARP могут быть статическими и динамическими. Пример, данный выше, описывает динамическую запись кэша. Можно также создавать статические записи в таблице В большинстве операционных систем это можно сделать при помощи команды:

`arp -s <IP-адрес> <MAC-адрес>`

В Windows Server 2003 записи в таблице ARP, созданные динамически, остаются в кэше в течение 2 минут. Если в течение этих двух минут произошла повторная передача данных по этому адресу, то время хранения записи в кэше продлевается ещё на 2 минуты. Эта процедура может повторяться несколько раз, но максимум запись в кэше просуществует до 10 минут. После этого запись будет удалена из кэша, и при необходимости будет отправлен повторный запрос ARP[[1]](https://ru.wikipedia.org/wiki/ARP#cite_note-1).

В более новых операционных системах время хранения записей в таблице ARP и метод хранения выбираются программно и при желании их можно изменить.